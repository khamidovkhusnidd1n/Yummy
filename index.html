<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yummy - Premium Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --accent: #dc2626;
        }

        body {
            font-family: 'Outfit', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background: #fcfcfc;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .dark body {
            background: #0c0c0c;
            color: white;
        }

        .category-active {
            background: var(--accent) !important;
            color: white !important;
            transform: scale(1.05);
            box-shadow: 0 10px 25px -5px rgba(220, 38, 38, 0.4);
        }

        .product-card {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 0, 0, 0.03);
            width: 100%;
            height: 100%;
        }

        .dark .product-card {
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .product-card:active {
            transform: scale(0.95);
        }

        .price-tag {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .category-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .category-item:active {
            transform: scale(0.9);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
        }

        .dark .glass {
            background: rgba(15, 15, 15, 0.7);
        }

        .image-zoom {
            transition: transform 0.8s cubic-bezier(0.2, 0, 0.2, 1);
        }

        .product-card:hover .image-zoom {
            transform: scale(1.1);
        }

        .sticky-cats {
            background: rgba(252, 252, 252, 0.9);
            backdrop-filter: blur(10px);
            z-index: 30;
        }

        .dark .sticky-cats {
            background: rgba(12, 12, 12, 0.9);
        }
    </style>
</head>

<body class="pb-32">
    <!-- Header -->
    <header
        class="fixed top-0 left-0 right-0 z-50 glass border-b border-gray-100 dark:border-zinc-800 px-6 py-4 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-black tracking-tighter text-red-600">YUMMY</h1>
        </div>
        <div class="flex gap-3">
            <button id="search-toggle"
                class="w-10 h-10 rounded-2xl bg-gray-100 dark:bg-zinc-800 flex items-center justify-center">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                </svg>
            </button>
            <button id="cart-btn"
                class="relative w-10 h-10 rounded-2xl bg-black dark:bg-white text-white dark:text-black flex items-center justify-center">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                    <path d="M4 4h2l3 12h10l3-9H7" />
                </svg>
                <span id="cart-count"
                    class="absolute -top-1.5 -right-1.5 bg-red-600 text-[10px] font-black text-white w-5 h-5 rounded-full flex items-center justify-center border-2 border-white dark:border-zinc-900 hidden">0</span>
            </button>
        </div>
    </header>

    <!-- Search Box -->
    <div id="search-container" class="fixed top-20 left-0 right-0 z-40 px-6 py-4 hidden animate-item">
        <input type="text" id="search-input" placeholder="Qanday taom qidiramiz? 🔎"
            class="w-full h-14 bg-white dark:bg-zinc-900 rounded-3xl px-6 font-bold shadow-2xl border-2 border-red-500/20 focus:border-red-500 outline-none transition-all">
    </div>

    <!-- Featured Section -->
    <section class="mt-28 px-6">
        <div class="relative w-full h-52 rounded-[45px] overflow-hidden shadow-2xl group">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1000&fit=crop"
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000">
            <div
                class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent p-8 flex flex-col justify-end">
                <span
                    class="bg-red-600 text-white text-[10px] font-black px-3 py-1 rounded-full w-fit mb-3 tracking-widest">TOP
                    TANLOV</span>
                <h2 class="text-white text-2xl font-black tracking-tight">Bugun nima yeymiz?</h2>
                <p class="text-white/60 text-xs font-bold mt-1">Barcha taomlar 100% tabiiy va mazali!</p>
            </div>
        </div>
    </section>

    <!-- Categories (Sticky) -->
    <div id="categories-container"
        class="sticky top-[72px] left-0 right-0 py-4 px-6 flex gap-3 overflow-x-auto no-scrollbar sticky-cats scroll-px-6 snap-x">
        <!-- JS renders this -->
    </div>

    <!-- Menu Sections (Vertical Flow) -->
    <div id="menu-sections" class="mt-6 space-y-8 pb-12 w-full flex flex-col">
        <!-- JS renders all categories and products vertically here -->
    </div>


    <!-- Simple Cart Sheet (Overlay) -->
    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div id="cart-overlay"
            class="absolute inset-0 bg-black/60 backdrop-blur-md opacity-0 transition-opacity duration-500"></div>
        <div id="cart-sheet"
            class="absolute bottom-0 left-0 right-0 bg-white dark:bg-[#0f0f0f] rounded-t-[50px] min-h-[70vh] p-8 translate-y-full transition-transform duration-500 flex flex-col">
            <div class="w-16 h-1.5 bg-gray-200 dark:bg-zinc-800 rounded-full mx-auto mb-8"></div>

            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-black tracking-tight">Savat</h2>
                    <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mt-1">Siz tanlagan mazali
                        taomlar</p>
                </div>
                <button id="clear-cart"
                    class="text-red-500 font-black text-xs uppercase tracking-wider">Tozalash</button>
            </div>

            <div id="cart-items" class="flex-grow space-y-6 overflow-y-auto max-h-[40vh] pr-2">
                <!-- JS renders items -->
            </div>

            <div class="mt-10 border-t border-gray-100 dark:border-zinc-800 pt-8">
                <!-- Promo Code Section -->
                <div class="mb-6">
                    <div class="relative group">
                        <input type="text" id="promo-input" placeholder="Promo kod (ixtiyoriy)"
                            class="w-full h-14 bg-gray-50 dark:bg-zinc-900 border-2 border-transparent focus:border-red-500/20 rounded-3xl px-6 font-bold outline-none transition-all uppercase placeholder:normal-case">
                        <div
                            class="absolute right-5 top-1/2 -translate-y-1/2 opacity-30 group-focus-within:opacity-100 transition-opacity">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"
                                viewBox="0 0 24 24">
                                <path
                                    d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                <path d="M9 3v2m0 4v2m0 4v2" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div id="cart-total" class="flex justify-between items-end mb-8">
                    <!-- JS renders total -->
                </div>

                <button id="checkout-btn"
                    class="w-full h-18 py-5 price-tag rounded-[30px] font-black text-white text-lg shadow-2xl shadow-red-500/40 active:scale-95 transition-all flex items-center justify-center gap-3">
                    <span>BUYURTMA BERISH</span>
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                        <path d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const urlParams = new URLSearchParams(window.location.search);
        const CURRENT_LANG = urlParams.get('lang') || 'uz';

        const LANG_STRINGS = {
            'uz': {
                'delivery': 'Premium Yetkazib Berish',
                'search_placeholder': 'Qanday taom qidiramiz? 🔎',
                'top_choice': 'TOP TANLOV',
                'featured_title': 'Bugun nima yeymiz?',
                'featured_sub': 'Barcha taomlar 100% tabiiy va mazali!',
                'not_found': 'Hech nima topilmadi... ☕️',
                'cart_title': 'Savat',
                'cart_sub': 'Siz tanlagan mazali taomlar',
                'cart_empty': 'Savatingiz bo\'sh 🛒',
                'total_label': 'Umumiy hisob',
                'order_btn': 'BUYURTMA BERISH',
                'promo_placeholder': 'Promo kod (ixtiyoriy)',

                'food_label': 'Taomlar',
                'deliv_label': 'Yetkazish',
                'confirm_btn': 'TASDIQLASH',
                'cats': {
                    "🌯 Lavash": "🌯 Lavash", "🍔 Burger": "🍔 Burger", "🥙 Doner": "🥙 Doner",
                    "🍗 KFC": "🍗 KFC", "🌭 Xot-dog": "🌭 Xot-dog", "🥪 Xaggi": "🥪 Xaggi",
                    "🍗 Naggets": "🍗 Nuggets", "🧀 Pishloqli yostiqchalar": "🧀 Pishloqli yostiqchalar",
                    "🥪 Klab sandwich": "🥪 Klab", "🍟 Fri": "🍟 Fri", "🥟 Somsa": "🥟 Somsa",
                    "☕️ Ichimliklar": "☕️ Ichimliklar", "🍹 Cocktails": "🍹 Cocktails",
                    "🔥 Specials": "🔥 Maxsus", "🥫 Souslar": "🥫 Souslar"
                }
            },
            'ru': {
                'delivery': 'Премиум Доставка',
                'search_placeholder': 'Что будем искать? 🔎',
                'top_choice': 'ТОП ВЫБОР',
                'featured_title': 'Что поедим сегодня?',
                'featured_sub': 'Все продукты 100% натуральные!',
                'not_found': 'Ничего не найдено... ☕️',
                'cart_title': 'Корзина',
                'cart_sub': 'Ваши выбранные блюда',
                'cart_empty': 'Корзина пуста 🛒',
                'total_label': 'Общая сумма',
                'order_btn': 'ОФОРМИТЬ ЗАКАЗ',
                'promo_placeholder': 'Промокод (необязательно)',

                'food_label': 'Блюда',
                'deliv_label': 'Доставка',
                'confirm_btn': 'ПОДТВЕРДИТЬ',
                'cats': {
                    "🌯 Lavash": "🌯 Лаваш", "🍔 Burger": "🍔 Бургер", "🥙 Doner": "🥙 Донер",
                    "🍗 KFC": "🍗 KFC", "🌭 Xot-dog": "🌭 Хот-дог", "🥪 Xaggi": "🥪 Хагги",
                    "🍗 Naggets": "🍗 Наггетсы", "🧀 Pishloqli yostiqchalar": "🧀 Сырные подушечки",
                    "🥪 Klab sandwich": "🥪 Клаб", "🍟 Fri": "🍟 Фри", "🥟 Somsa": "🥟 Сомса",
                    "☕️ Ichimliklar": "☕️ Напитки", "🍹 Cocktails": "🍹 Коктейли",
                    "🔥 Specials": "🔥 Акции", "🥫 Souslar": "🥫 Соусы"
                }
            },
            'en': {
                'delivery': 'Premium Delivery',
                'search_placeholder': 'What are we looking for? 🔎',
                'top_choice': 'TOP CHOICE',
                'featured_title': 'What shall we eat today?',
                'featured_sub': 'All ingredients are 100% natural!',
                'not_found': 'Nothing found... ☕️',
                'cart_title': 'Cart',
                'cart_sub': 'Your selected delicious items',
                'cart_empty': 'Your cart is empty 🛒',
                'total_label': 'Total amount',
                'order_btn': 'PLACE ORDER',
                'promo_placeholder': 'Promo code (optional)',

                'food_label': 'Food',
                'deliv_label': 'Delivery',
                'confirm_btn': 'CONFIRM',
                'cats': {
                    "🌯 Lavash": "🌯 Lavash", "🍔 Burger": "🍔 Burger", "🥙 Doner": "🥙 Doner",
                    "🍗 KFC": "🍗 KFC", "🌭 Xot-dog": "🌭 Hot-dog", "🥪 Xaggi": "🥪 Haggi",
                    "🍗 Naggets": "🍗 Nuggets", "🧀 Pishloqli yostiqchalar": "🧀 Cheese pillows",
                    "🥪 Klab sandwich": "🥪 Club", "🍟 Fri": "🍟 Fries", "🥟 Somsa": "🥟 Somsa",
                    "☕️ Ichimliklar": "☕️ Drinks", "🍹 Cocktails": "🍹 Cocktails",
                    "🔥 Specials": "🔥 Specials", "🥫 Souslar": "🥫 Sauces"
                }
            }
        };

        const S = LANG_STRINGS[CURRENT_LANG] || LANG_STRINGS['uz'];

        const ITEM_NAMES = {
            uz: {
                // Menu data is authored in Uzbek; mapping is optional here.
            },
            ru: {
                "Standart": "Стандарт",
                "Pishloqli": "С сыром",
                "Big": "Большой",
                "Big pishloq": "Большой с сыром",
                "Big (45sm)": "Большой (45 см)",
                "Canada (45sm)": "Канада (45 см)",
                "Super (45sm)": "Супер (45 см)",
                "Chiz": "Сырный",
                "Gamburger": "Гамбургер",
                "Chizburger": "Чизбургер",
                "Double": "Дабл",
                "Double chiz": "Дабл чиз",
                "Go'shtli": "С мясом",
                "Pishloqli tovuq": "Сырная курица",
                "Nuggets": "Наггетсы",
                "Nuggets mini": "Наггетсы мини",
                "File strips": "Стрипсы",
                "Qanot": "Крылышки",
                "Kartoshka": "Картошка фри",
                "Lunch box": "Ланч-бокс",
                "Mini": "Мини",
                "Twins": "Твинс",
                "Sous": "Соус",
                "Yostiqchalar": "Подушечки",
                "Yostiqchalar mini": "Подушечки мини",
                "Choy": "Чай",
                "Choy mevali": "Фруктовый чай",
                "O'rmon mevalari": "Лесные ягоды",
                "Ko'k": "Синий",
                "Kofe": "Кофе",
                "Kofe (Big)": "Кофе (большой)",
                "Moxito": "Мохито",
                "Tropic": "Тропик",
                "Xot let": "Горячий латте",
                "Kfc xaggi": "KFC Хагги",
                "Kfc BURGER (+0.25 Cola)": "KFC BURGER (+0.25 Cola)",
                "Kfc HAGGI (+0.25 Cola)": "KFC HAGGI (+0.25 Cola)"
            },
            en: {
                "Standart": "Standard",
                "Pishloqli": "Cheese",
                "Big": "Big",
                "Big pishloq": "Big cheese",
                "Big (45sm)": "Big (45 cm)",
                "Canada (45sm)": "Canada (45 cm)",
                "Super (45sm)": "Super (45 cm)",
                "Chiz": "Cheese",
                "Gamburger": "Hamburger",
                "Chizburger": "Cheeseburger",
                "Double": "Double",
                "Double chiz": "Double cheese",
                "Go'shtli": "Meat",
                "Pishloqli tovuq": "Cheesy chicken",
                "Nuggets": "Nuggets",
                "Nuggets mini": "Nuggets mini",
                "File strips": "Fillet strips",
                "Qanot": "Wings",
                "Kartoshka": "Fries",
                "Lunch box": "Lunch box",
                "Mini": "Mini",
                "Twins": "Twins",
                "Sous": "Sauce",
                "Yostiqchalar": "Cheese pillows",
                "Yostiqchalar mini": "Mini cheese pillows",
                "Choy": "Tea",
                "Choy mevali": "Fruit tea",
                "O'rmon mevalari": "Forest berries",
                "Ko'k": "Blue",
                "Kofe": "Coffee",
                "Kofe (Big)": "Coffee (Large)",
                "Moxito": "Mojito",
                "Tropic": "Tropical",
                "Xot let": "Hot latte",
                "Kfc xaggi": "KFC Haggi",
                "Kfc BURGER (+0.25 Cola)": "KFC BURGER (+0.25 Cola)",
                "Kfc HAGGI (+0.25 Cola)": "KFC HAGGI (+0.25 Cola)"
            }
        };
        // Apply Static Translations
        document.getElementById('search-input').placeholder = S.search_placeholder;
        document.querySelector('.bg-red-600.text-white.text-\\[10px\\]').innerText = S.top_choice;
        document.querySelector('h2.text-white.text-2xl').innerText = S.featured_title;
        document.querySelector('p.text-white\\/60').innerText = S.featured_sub;
        document.querySelector('#cart-sheet h2').innerText = S.cart_title;
        document.querySelector('#cart-sheet p.text-gray-400').innerText = S.cart_sub;
        document.querySelector('#checkout-btn span').innerText = S.order_btn;
        document.getElementById('promo-input').placeholder = S.promo_placeholder;


        tg.expand();
        tg.ready();

        if (tg.colorScheme === 'dark') {
            document.documentElement.classList.add('dark');
            tg.setHeaderColor('#0f0f0f');
            tg.setBackgroundColor('#0c0c0c');
        }

        const MENU_DATA = {
            "🌯 Lavash": [
                { "n": "Standart", "p": 30000, "i": "images/lavash.png" },
                { "n": "Pishloqli", "p": 35000, "i": "images/lavash.png" },
                { "n": "Big", "p": 40000, "i": "images/lavash.png" },
                { "n": "Big pishloq", "p": 45000, "i": "images/lavash.png" }
            ],
            "🍔 Burger": [
                { "n": "Gamburger", "p": 28000, "i": "images/burger.png" },
                { "n": "Chizburger", "p": 33000, "i": "images/burger.png" },
                { "n": "Double", "p": 35000, "i": "images/double_burger.png" },
                { "n": "Double chiz", "p": 40000, "i": "images/double_burger.png" }
            ],
            "🥙 Doner": [
                { "n": "Standart", "p": 25000, "i": "images/image2/donar.png" },
                { "n": "Big", "p": 30000, "i": "images/image2/donar.png" },
                { "n": "Chiz", "p": 35000, "i": "images/image2/donar.png" }
            ],
            "🍗 KFC": [
                { "n": "File strips", "p": 90000, "i": "images/kfc_strips.png" },
                { "n": "Qanot", "p": 85000, "i": "images/kfc_wings.png" },
                { "n": "Lunch box", "p": 30000, "i": "images/kfc_lunch.png" },
                { "n": "Kfc xaggi", "p": 30000, "i": "images/image2/xaggi.png" }
            ],
            "🌭 Xot-dog": [
                { "n": "Mini", "p": 10000, "i": "images/image2/hot_dog.png" },
                { "n": "Twins", "p": 17000, "i": "images/image2/hot_dog.png" },
                { "n": "Big (45sm)", "p": 22000, "i": "images/image2/hot_dog.png" },
                { "n": "Super (45sm)", "p": 25000, "i": "images/image2/hot_dog.png" },
                { "n": "Canada (45sm)", "p": 25000, "i": "images/hotdog_canada.png" }
            ],
            "🥪 Xaggi": [
                { "n": "Standart", "p": 35000, "i": "images/image2/xaggi.png" },
                { "n": "Big", "p": 45000, "i": "images/image2/xaggi.png" },
                { "n": "Xot let", "p": 28000, "i": "images/image2/xaggi.png" }
            ],
            "🍗 Naggets": [
                { "n": "Nuggets", "p": 22000, "i": "images/naggets.png" },
                { "n": "Nuggets mini", "p": 11000, "i": "images/naggets.png" }
            ],
            "🧀 Pishloqli yostiqchalar": [
                { "n": "Yostiqchalar", "p": 28000, "i": "images/pishloqli.png" },
                { "n": "Yostiqchalar mini", "p": 14000, "i": "images/pishloqli.png" }
            ],
            "🥪 Klab sandwich": [
                { "n": "Standart", "p": 35000, "i": "images/sandwich.png" }
            ],
            "🍟 Fri": [
                { "n": "Standart", "p": 15000, "i": "images/fri.png" },
                { "n": "Big", "p": 17000, "i": "images/fri.png" }
            ],
            "🥟 Somsa": [
                { "n": "Go'shtli", "p": 10000, "i": "images/somsa.png" },
                { "n": "Pishloqli tovuq", "p": 7000, "i": "images/somsa.png" },
                { "n": "Ko'k", "p": 5000, "i": "images/somsa.png" },
                { "n": "Kartoshka", "p": 5000, "i": "images/somsa.png" }
            ],
            "☕️ Ichimliklar": [
                { "n": "Choy", "p": 3000, "i": "images/image2/tea.png" },
                { "n": "Kofe", "p": 5000, "i": "images/image2/coffee.png" },
                { "n": "Kofe (Big)", "p": 7000, "i": "images/image2/coffee.png" },
                { "n": "Choy mevali", "p": 10000, "i": "images/image2/tea_via_fruits.png" }
            ],
            "🍹 Cocktails": [
                { "n": "Tropic", "p": 15000, "i": "images/image2/tropic.png" },
                { "n": "Moxito", "p": 15000, "i": "images/image2/moxito.png" },
                { "n": "O'rmon mevalari", "p": 15000, "i": "images/image2/forest_fruits.png" }
            ],
            "🔥 Specials": [
                { "n": "Kfc BURGER (+0.25 Cola)", "p": 33000, "i": "images/image2/kfc_burger.png" },
                { "n": "Kfc HAGGI (+0.25 Cola)", "p": 38000, "i": "images/image2/kfc_haggi_cola.png" }
            ],
            "🥫 Souslar": [
                { "n": "Sous", "p": 4000, "i": "images/image2/sous.png" }
            ]
        };

        let cart = [];
        let activeCategory = Object.keys(MENU_DATA)[0];
        let idCounter = 1;

        const FLAT_ITEMS = [];
        Object.keys(MENU_DATA).forEach(cat => {
            MENU_DATA[cat].forEach(item => {
                const translatedName = (ITEM_NAMES[CURRENT_LANG] && ITEM_NAMES[CURRENT_LANG][item.n]) || item.n;
                FLAT_ITEMS.push({ id: idCounter++, raw_name: item.n, name: translatedName, price: item.p, image: item.i, cat: cat });
            });
        });

        function renderCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = Object.keys(MENU_DATA).map(cat => {
                const safeId = cat.replace(/[^a-zA-Z0-9]/g, '');
                return `
                    <button id="nav-${safeId}" onclick="selectCategory('${cat}')" 
                        class="category-btn whitespace-nowrap px-8 py-3.5 rounded-3xl text-sm font-black tracking-tight transition-all snap-start bg-gray-100 dark:bg-zinc-800 text-gray-500 dark:text-zinc-500">
                        ${S.cats[cat] || cat}
                    </button>
                `;
            }).join('');
        }

        function renderMenu(searchTerm = "") {
            const container = document.getElementById('menu-sections');

            if (searchTerm) {
                const filtered = FLAT_ITEMS.filter(i => i.name.toLowerCase().includes(searchTerm.toLowerCase()));
                container.innerHTML = `
                    <div class="px-6 grid grid-cols-2 gap-4">
                        ${filtered.map(item => renderProductCard(item)).join('')}
                    </div>
                `;
                if (!filtered.length) container.innerHTML = `<div class="py-20 text-center text-gray-400 font-bold">${S.not_found}</div>`;
                return;
            }

            // Continuous vertical flow of all categories
            container.innerHTML = Object.keys(MENU_DATA).map(cat => {
                const safeId = cat.replace(/[^a-zA-Z0-9]/g, '');
                return `
                    <div id="section-${safeId}" class="menu-section mb-12" data-category="${cat}">
                        <div class="px-6 mb-4">
                            <h2 class="text-2xl font-black tracking-tighter text-gray-900 dark:text-white flex items-center gap-3">
                                <span class="w-1.5 h-8 bg-red-600 rounded-full"></span>
                                ${S.cats[cat] || cat}
                            </h2>
                        </div>
                        <div class="px-6 grid grid-cols-2 gap-4">
                            ${MENU_DATA[cat].map(item => renderProductCard(item)).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            setTimeout(initScrollSpy, 100);
        }


        function renderProductCard(item) {
            const baseName = item.raw_name || item.n || item.name;
            const name = (ITEM_NAMES[CURRENT_LANG] && ITEM_NAMES[CURRENT_LANG][baseName]) || item.name || baseName;
            const price = item.p || item.price;
            const img = item.i || item.image;
            return `
                <div class="product-card bg-white dark:bg-[#1a1a1a] rounded-[45px] p-3 shadow-xl shadow-black/5 flex flex-col justify-between w-full">
                    <div class="relative w-full aspect-square bg-gray-50 dark:bg-zinc-800 rounded-[38px] overflow-hidden">
                        <img src="${img}" 
                             onerror="this.onerror=null; this.src='images/burger.png';" 
                             class="w-full h-full object-cover image-zoom">
                        <button onclick="addToCartByName('${name}', ${price}, '${img}')" 
                                class="absolute bottom-2 right-2 w-9 h-9 price-tag rounded-full shadow-md shadow-red-500/30 flex items-center justify-center text-white active:scale-90 transition-all hover:scale-110">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="3.5" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                        </button>
                    </div>
                    <div class="px-4 py-5">
                        <h3 class="font-black text-[12px] leading-tight tracking-tight text-gray-800 dark:text-zinc-100 line-clamp-2 h-8">${name}</h3>
                        <p class="text-red-500 font-extrabold text-[15px] mt-1 tracking-tighter">${price.toLocaleString()} so'm</p>
                    </div>
                </div>
            `;
        }


        window.addToCartByName = (name, price, image) => {
            const inCart = cart.find(i => i.name === name);
            if (inCart) inCart.quantity += 1;
            else cart.push({ name, price, image, quantity: 1, id: Date.now() });
            updateCartUI();
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        let isScrollingByClick = false;

        window.selectCategory = (cat) => {
            isScrollingByClick = true;
            activeCategory = cat;
            updateActiveCategoryUI(cat);

            const safeId = cat.replace(/[^a-zA-Z0-9]/g, '');
            const element = document.getElementById(`section-${safeId}`);
            if (element) {
                const headerOffset = 140;
                const elementPosition = element.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
            }

            setTimeout(() => { isScrollingByClick = false; }, 800);
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        }

        function updateActiveCategoryUI(cat) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('category-active');
                btn.classList.add('bg-gray-100', 'dark:bg-zinc-800', 'text-gray-500', 'dark:text-zinc-500');
            });
            const safeId = cat.replace(/[^a-zA-Z0-9]/g, '');
            const activeBtn = document.getElementById(`nav-${safeId}`);
            if (activeBtn) {
                activeBtn.classList.add('category-active');
                activeBtn.classList.remove('bg-gray-100', 'dark:bg-zinc-800', 'text-gray-500', 'dark:text-zinc-500');
                activeBtn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }

        function initScrollSpy() {
            const sections = document.querySelectorAll('.menu-section');
            const options = {
                root: null,
                rootMargin: '-150px 0px -70% 0px',
                threshold: 0
            };

            const observer = new IntersectionObserver((entries) => {
                if (isScrollingByClick) return;
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const cat = entry.target.getAttribute('data-category');
                        updateActiveCategoryUI(cat);
                    }
                });
            }, options);

            sections.forEach(section => observer.observe(section));
        }


        function updateCartUI() {
            const count = cart.reduce((sum, i) => sum + i.quantity, 0);
            const countEl = document.getElementById('cart-count');
            if (count > 0) { countEl.innerText = count; countEl.classList.remove('hidden'); tg.MainButton.setText(`${S.confirm_btn} (${count})`); tg.MainButton.show(); tg.MainButton.setParams({ color: '#dc2626', text_color: '#ffffff' }); }
            else { countEl.classList.add('hidden'); tg.MainButton.hide(); }
        }

        const modal = document.getElementById('cart-modal');
        const sheet = document.getElementById('cart-sheet');
        const overlay = document.getElementById('cart-overlay');

        function openCart() {
            modal.classList.remove('hidden');
            setTimeout(() => { overlay.style.opacity = "1"; sheet.classList.remove('translate-y-full'); }, 10);
            renderCartItems();
        }

        function closeCart() {
            overlay.style.opacity = "0"; sheet.classList.add('translate-y-full');
            setTimeout(() => modal.classList.add('hidden'), 500);
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            let total = cart.reduce((sum, i) => sum + (i.price * i.quantity), 0);
            if (cart.length === 0) { container.innerHTML = `<div class="py-10 text-center text-gray-400 font-bold tracking-tight">${S.cart_empty}</div>`; }
            else {
                container.innerHTML = cart.map(item => `
                    <div class="flex items-center gap-5 animate-item">
                        <div class="w-20 h-20 rounded-[28px] bg-gray-50 flex-shrink-0 overflow-hidden shadow-sm">
                            <img src="${item.image}" 
                                 onerror="this.onerror=null; this.src='images/burger.png';"
                                 class="w-full h-full object-cover">
                        </div>
                        <div class="flex-grow"><h4 class="font-black text-base tracking-tighter">${item.name}</h4><p class="text-red-500 font-extrabold text-sm mt-1">${item.price.toLocaleString()} so'm</p></div>
                        <div class="flex items-center gap-4 bg-gray-100 dark:bg-zinc-800 rounded-3xl p-2">
                            <button onclick="changeQty(${item.id}, -1)" class="w-8 h-8 rounded-2xl bg-white dark:bg-zinc-700 shadow-md flex items-center justify-center font-black">-</button>
                            <span class="text-sm font-black w-4 text-center">${item.quantity}</span>
                            <button onclick="changeQty(${item.id}, 1)" class="w-8 h-8 rounded-2xl bg-white dark:bg-zinc-700 shadow-md flex items-center justify-center font-black">+</button>
                        </div>
                    </div>
                `).join('');
            }
            const deliveryFee = 15000;
            const finalTotal = total > 0 ? total + deliveryFee : 0;
            document.getElementById('cart-total').innerHTML = `<div class="text-right"><p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">${S.food_label}: ${total.toLocaleString()} so'm</p><p class="text-[10px] text-red-500 font-bold uppercase tracking-widest mb-2">${S.deliv_label}: ${deliveryFee.toLocaleString()} so'm</p><p class="text-4xl font-black tracking-tighter text-red-600">${finalTotal.toLocaleString()} so'm</p></div>`;
        }

        window.changeQty = (id, delta) => { const idx = cart.findIndex(i => i.id === id); cart[idx].quantity += delta; if (cart[idx].quantity <= 0) cart.splice(idx, 1); renderCartItems(); updateCartUI(); if (cart.length === 0) closeCart(); if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light'); }
        document.getElementById('cart-btn').onclick = openCart;
        overlay.onclick = closeCart;
        document.getElementById('clear-cart').onclick = () => { cart = []; updateCartUI(); closeCart(); };
        document.getElementById('checkout-btn').onclick = () => {
            const total = cart.reduce((sum, i) => sum + (i.price * i.quantity), 0);
            const deliveryFee = 15000;
            const promo = document.getElementById('promo-input').value.trim();

            const payload = {
                type: 'order',
                items: cart,
                total: (total + deliveryFee),
                promo_code: promo || null
            };

            const send = () => {
                tg.sendData(JSON.stringify(payload));
                tg.close();
            };

            // Try to attach GPS automatically (requires user permission)
            try {
                const cached = localStorage.getItem('yummy_last_geo');
                if (cached) payload.location = JSON.parse(cached);
            } catch (e) { }

            if (!navigator.geolocation) return send();

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    payload.location = {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude,
                        accuracy: pos.coords.accuracy,
                        ts: Date.now()
                    };
                    try { localStorage.setItem('yummy_last_geo', JSON.stringify(payload.location)); } catch (e) { }
                    send();
                },
                () => send(),
                { enableHighAccuracy: true, timeout: 4000, maximumAge: 600000 }
            );
        };

        tg.onEvent('mainButtonClicked', openCart);
        const toggle = document.getElementById('search-toggle');
        const box = document.getElementById('search-container');
        const input = document.getElementById('search-input');
        toggle.onclick = () => { box.classList.toggle('hidden'); if (!box.classList.contains('hidden')) input.focus(); }
        input.oninput = (e) => renderMenu(e.target.value);
        renderCategories();
        renderMenu();
    </script>
</body>

</html>